import{_ as y,a as j,o as x,c as C,w as D,v as V,b as a,r as n,d as L,e as r,t as d}from"./index-6c2acd9a.js";const H={id:"media"},q={id:"video",playsinline:"",autoplay:"",style:{"max-height":"100%"},class:"width-fill"},J={id:"canvas",style:{"max-height":"100%"},class:"width-fill"},K={__name:"videoStream",props:{setVideo:{type:Function,default:()=>{}},setCanvas:{type:Function,default:()=>{}},isVideoOpen:{type:Boolean,default:!0},isCanvasOpen:{type:Boolean,default:!1}},setup(v){const o=v;return j(()=>{o.setVideo(document.getElementById("video")),o.setCanvas(document.getElementById("canvas"))}),(l,c)=>(x(),C("div",H,[D(a("video",q,null,512),[[V,v.isVideoOpen]]),D(a("canvas",J,null,512),[[V,v.isCanvasOpen]])]))}},Q=y(K,[["__file","C:/Users/User/Desktop/project/vite-vue-test/src/components/camera/videoStream.vue"]]);const W={id:"camera",style:{"overflow-y":"scroll","overflow-x":"clip"},class:"pb-5"},X={class:"d-flex flex-column vw-100 vh-100",style:{"background-color":"#FFF"}},Y={class:"d-flex flex-column align-items-center mt-3"},Z={class:"d-flex"},ee={class:"mb-0"},te={class:"mb-0"},ae={class:"d-flex"},se={class:"mb-0"},ie={class:"mb-0"},ne={class:"d-flex"},oe={class:"mb-0"},ce={class:"mb-0"},le={class:"d-flex"},re={class:"mb-0"},de={id:"resultContainer",class:"rounded position-relative",style:{height:"300px",width:"max-content",margin:"auto","max-width":"100%"}},ve=["src"],ue={__name:"camera",props:{msg:String},setup(v){const o=n(null),l=n(null),c=n(null),U=n(null),u=n("environment"),h=n({audio:!1,video:{frameRate:{min:1,max:60},facingMode:u.value,width:{min:480,ideal:640,max:800},height:{min:360,ideal:480,max:600},aspectRatio:4/3,resizeMode:"none"}}),w=n(!0),m=n(!1),g=n({height:"",width:""}),_=n({height:"",width:""}),p=n({height:"",width:""}),O=n(window.devicePixelRatio);j(()=>{T(),f()});const $=t=>{o.value=t},E=t=>{l.value=t},T=()=>{window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(i,s){e.call(navigator,t,i,s)}):Promise.reject(new Error("當前版本瀏覽器不支援該功能，請先進行更新後繼續使用，謝謝。"))})},f=async()=>{await window.navigator.mediaDevices.getUserMedia(h.value).then(t=>P(t,o.value)).catch(F)},B=()=>{const{width:t,height:e,aspectRatio:i}=o.value.srcObject.getTracks()[0].getSettings();console.log(t,e),_.value.width=t,_.value.height=e,p.value.width=t,p.value.height=e;const s=l.value.getContext("2d");l.value.width=t,l.value.height=e,s.imageSmoothingEnabled=!1,s.mozImageSmoothingEnabled=!1,s.clearRect(0,0,t,e),s.save(),s.scale(1,1),s.drawImage(o.value,0,0,t,e),s.restore()},I=()=>{w.value=!0,m.value=!1},k=()=>{w.value=!1,m.value=!0};function P(t,e){c.value=t;let{width:i,height:s,aspectRatio:b}=c.value.getTracks()[0].getSettings();console.log(c.value.getTracks()[0].getSettings()),g.value.width=i,g.value.height=s;try{e.srcObject=c.value,alert(`${e.width} ,${e.height}`)}catch{e.src=window.URL&&window.URL.createObjectURL(c.value)||c.value}finally{e.play()}console.log(e.videoHeight)}function F(t){alert("執行錯誤 : 您的裝置沒有提供可以進行拍攝的設備")}async function z(t){if(console.log(m.value),o.value)try{o.value.pause(),B(),await c.value.getTracks().forEach(e=>{e.stop()}),k()}catch{console.error("相機尚未準備好")}k()}function G(t){f(),I()}async function N(t){switch(t.target.disabled=!0,c.value&&await c.value.getTracks().forEach(e=>{e.stop()}),u.value){case"environment":h.value.video.facingMode="user",u.value="user",await navigator.mediaDevices.enumerateDevices().then(function(e){if(e=e.filter(function(i){return i.kind==="videoinput"}),navigator.userAgent.toLowerCase().indexOf("android")>0)for(let i=0;i<e.length;i++){let s=e[i];if(s.label&&s.label.split(",")[1]==="facing front"){h.video={deviceId:{exact:s.deviceId}};break}}}),await f();break;case"user":h.value.video.facingMode="environment",u.value="environment",await f();break}t.target.disabled=!1}function A(t){U.value=l.value.toDataURL()}return(t,e)=>{var i,s,b,S,R,M;return x(),C("div",W,[a("div",X,[L(Q,{"set-video":$,"set-canvas":E,"is-canvas-open":m.value,"is-video-open":w.value},null,8,["is-canvas-open","is-video-open"]),a("div",{id:"control",class:"d-flex justify-content-around"},[a("button",{type:"button",class:"btn btn-primary",onClick:z},"Snap"),a("button",{type:"button",class:"btn btn-primary",onClick:G},"Cancel"),a("button",{type:"button",class:"btn btn-primary",onClick:N},"Toggle"),a("button",{type:"button",class:"btn btn-primary",onClick:A},"To IMG")]),a("div",Y,[a("div",Z,[r(" 目前 mediaStreams 資訊--> "),a("p",ee,"width : "+d((i=g.value)==null?void 0:i.width),1),r(", "),a("p",te,"height : "+d((s=g.value)==null?void 0:s.height),1)]),a("div",ae,[r(" 目前 videoStreams 資訊--> "),a("p",se,"width : "+d((b=_.value)==null?void 0:b.width),1),r(", "),a("p",ie,"height : "+d((S=_.value)==null?void 0:S.height),1)]),a("div",ne,[r(" 目前 canvasStreams 資訊--> "),a("p",oe,"width : "+d((R=p.value)==null?void 0:R.width),1),r(", "),a("p",ce,"height : "+d((M=p.value)==null?void 0:M.height),1)]),a("div",le,[r(" 目前 devicePixelRatio 資訊--> "),a("p",re,"ratio : "+d(O.value),1)])]),a("div",de,[a("img",{id:"result-img-data",src:U.value,alt:"upload img result",class:"h-100 rounded w-100",style:{"object-fit":"contain"}},null,8,ve)])])])}}},he=y(ue,[["__file","C:/Users/User/Desktop/project/vite-vue-test/src/components/camera/camera.vue"]]),me={__name:"camera",setup(v){return(o,l)=>(x(),C("div",null,[L(he)]))}},_e=y(me,[["__file","C:/Users/User/Desktop/project/vite-vue-test/src/views/camera.vue"]]);export{_e as default};
